---
title: 'Multi-signature transactions in a Peer-to-Peer World'
description: 'The quest to decentralize multi-signature coordination'
image:
  src: /img/blog/musig2-p2p.jpg
authors:
  - name: Matthew Urgero
    to: https://x.com/mcp011011
    avatar:
      src: /img/matthew_urgero.jpeg
date: 2025-11-13
badge:
  label: Technical Deep Dive
---

Multi-signature wallets promise shared custody and collaborative governance, but coordination breaks down without a central server. Someone needs to collect nonces, aggregate signatures, and broadcast transactions.

The usual solutions—trust a coordinator, run your own infrastructure, or coordinate manually—don't work for most users. Manual coordination doesn't scale. Running infrastructure requires expertise. So most people trust a central coordinator, contradicting cryptocurrency's core principles.

The MuSig2 P2P implementation in lotus-lib takes a different approach. Participants discover each other automatically, coordinate cryptographically, and elect coordinators deterministically—no central servers, no manual processes, no trust beyond the math.

## What is MuSig2?

MuSig2 is a multi-signature scheme where multiple parties create a single Schnorr signature. Unlike traditional multi-sig (multiple public keys in a script), MuSig2 produces an aggregated public key and single signature indistinguishable from a standard transaction.

A three-person treasury appears on-chain like a single-person payment. No indication of multiple signers. This is genuine privacy: making sophisticated transactions blend with everyday activity.

## Why MuSig2 Matters

Traditional P2SH multi-sig for three participants needs 99 bytes of public keys and 210 bytes of signatures. MuSig2 with Taproot uses 33 bytes and 64 bytes—83% smaller. Lower fees, less bloat, better scaling.

Security is provably sound under the [discrete logarithm assumption](https://en.wikipedia.org/wiki/Discrete_logarithm). MuSig2 prevents rogue key attacks through key aggregation coefficients and nonce reuse through session management. These are mathematically guaranteed properties.

The coordination problem: MuSig2 requires two communication rounds between all participants—nonce exchange, partial signature exchange, aggregation, and broadcasting. In a decentralized context, who orchestrates this?

## The Problem

Three people run a multi-sig treasury. Alice initiates a spend. Bob and Charlie need to participate. Without a central server, how do they find each other?

Manual coordination—passing transaction details via email or messaging—works for small stable groups but fails for dynamic or larger councils.

The traditional solution: deploy a coordination server that collects nonces, tracks signatures, aggregates results, and broadcasts. This creates a central point of failure and trust. The server sees everything. If it goes down, coordination stops. If compromised, privacy disappears.

Key challenges:

- How do wallets discover signing sessions without a directory server?
- How do participants authenticate messages without a trusted mediator?
- How do you prevent replay attacks without session state tracking?
- Who builds and broadcasts the final transaction?
- What happens when they refuse or crash?

These are why most multi-sig implementations require manual coordination or trusted servers.

## The Solution

Distributed systems already solved similar problems: Kademlia DHT for discovery, GossipSub for pub/sub, Byzantine consensus for trustless agreement. We applied these patterns to multi-party signatures.

**Discovery uses multiple channels**. A DHT stores session announcements persistently. Alice creates a session and announces to 20 DHT nodes; Bob and Charlie query to discover it. DHT queries are slow (seconds), so we added GossipSub pub/sub for instant notifications (10-100ms). Once participants connect, direct P2P handles signing. Result: distributed state with no central directory.

**Security has multiple layers**. Every message is cryptographically signed—you can't fake nonces or signatures without the private key. Rate limiting (one ad per 60 seconds) prevents spam. Peer reputation tracking flags patterns: repeated failures, invalid signatures, protocol violations accumulate into scores triggering automatic bans. Protocol phase enforcement prevents sending partial signatures before nonce exchange. Optional burn-based identity adds economic cost to Sybil attacks: burn XPI on-chain for immutable proof tied to the blockchain, not your signing key. Key rotation doesn't reset reputation.

**Coordinator election solves broadcasting without coordination overhead**. All participants run the same deterministic algorithm on the same public keys—everyone arrives at the same coordinator with no voting or consensus round. If the coordinator fails to broadcast within timeout, automatic failover moves to the next. The failover sequence is deterministic. The system handles up to N-1 coordinator failures (Byzantine fault tolerance).

We didn't invent new cryptography or consensus. We applied proven distributed systems techniques to multi-party signatures.

## What This Unlocks

Organizations can run multi-sig treasuries without coordination headaches. No scheduling calls. No manually passing signatures through messaging apps. Participants discover each other automatically. The protocol handles coordination. The elected coordinator broadcasts. Works for 2-of-2 DAOs or 10-of-10 councils.

Deeper implications:

**Payment channels**: Lightning-style channels need parties to sign state updates. P2P coordination handles this seamlessly with no intermediary servers and automatic failover if someone goes offline. The coordination layer becomes invisible.

**Atomic swaps**: Traditional implementations rely on smart contracts or escrow. MuSig2 enables true P2P atomic swaps with cryptographic security replacing contractual trust. Coordinator election ensures one party broadcasts while others sign.

**Vaults with recovery**: Time-locked vaults with emergency recovery—the primary keyset has its deterministic coordinator, the emergency keyset a different one. Both work trustlessly without central coordination.

These patterns extend beyond simple multi-sig. SwapSig, our CoinJoin-equivalent privacy protocol, uses the same infrastructure: shared MuSig2 outputs, circular rotation, transaction graph unlinkage—all P2P coordinated. It's the foundation for privacy-preserving protocols.

## Where We Are

The implementation works. 91+ tests pass, from basic 2-of-2 signing to complex coordinator failover. Automatic session cleanup prevents memory leaks. Replay protection uses per-signer sequence numbers. Signature verification happens at receipt, not aggregation—trust-free from the ground up.

Connection management separates general P2P connections (network health) from session-specific connections (signing coordination). Wallet connection limits won't block multi-sig sessions. The optional burn-based identity system adds economic cost to Sybil attacks while enabling key rotation—identity anchors to an immutable burn transaction, not your mutable signing key.

Taproot integration creates subtle power. With the [upcoming Taproot re-activation](https://lotusia.org/blog/winter-solstice-2025), Lotus will have access to all of these privacy enhancements. The aggregated MuSig2 public key becomes the Taproot internal key. Key path spends are indistinguishable from single-sig on-chain. A 3-of-3 spend looks like someone buying coffee. Complex script trees (time locks, hash locks, alternate keysets) remain hidden until spent via script path. Privacy through indistinguishability.

## Building With It

The implementation lives in [lotus-lib](https://github.com/LotusiaStewardship/lotus-lib). Working examples demonstrate 2-of-2 signing, multi-party coordinator election, Taproot integration. The [documentation](https://github.com/LotusiaStewardship/lotus-lib/blob/master/lib/p2p/musig2/README.md) covers architecture, security, and API details.

We're seeking feedback from developers. Install, experiment, break things, report issues. The more people testing in different contexts, the better the system becomes.

## The Path Forward

Multi-signature schemes existed for decades. MuSig2 brought them to Schnorr signatures with strong security and efficiency guarantees. But coordination remained the bottleneck where theory met practice and compromised.

We built this because compromise wasn't acceptable. Technology should enhance human relationships, not replace them. Multi-sig treasuries work better when humans make governance decisions ("should we spend this?") and protocols handle technical coordination ("how do we sign?"). P2P coordination makes the technical part invisible.

The code works. The tests pass. The cryptography is sound. Now comes what matters: using it, stress-testing it, discovering edge cases, refining based on real-world feedback.

Good infrastructure gets built carefully and incrementally. One careful protocol at a time.

---

**Resources:**

- [MuSig2 P2P Documentation](https://github.com/LotusiaStewardship/lotus-lib/tree/master/lib/p2p/musig2) - Complete API reference and examples
- [lotus-lib Repository](https://github.com/LotusiaStewardship/lotus-lib) - Source code and test suite
- [BIP327 Specification](https://github.com/bitcoin/bips/blob/master/bip-0327.mediawiki) - MuSig2 protocol details
- [Lotus Documentation](https://lotusia.org/docs) - Blockchain and developer guides

**Community:**

- [Discord](https://discord.gg/fZrFa3vf) - Real-time discussion
- [Telegram](https://t.me/LotusiaDiscourse) - Community discourse
- [GitHub Issues](https://github.com/LotusiaStewardship/lotus-lib/issues) - Technical questions
